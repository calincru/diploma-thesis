\chapter{Design and implementation}
In this chapter we delve into the design and the implementation details of\\
\TOOL, the tool we built to generate SEFL models from iptables configurations
with the end goal of having them integrated in complex networks which can then
be verified using SymNet.

We begin with a high-level outline of the computation steps that take place
between reading iptables rules from configuration files to returning a model as
expected by SymNet.  Following that, we take each of those steps separately and
discuss the most important aspects of their implementation details.  At the end
we go into more details about a few extensions to illustrate how
straightforward it is to add new extensions, both structurally and logically.


\section{Design overview}




\section{Implementation}
\todo{Could also mention the size of the project; 4k + 4k, "out of tree"
(SymNet); not really "test-driven", but more like "tested"}
\todo{this chapter shows how some of the things discussed in the previous
section are implemented;}
\todo{add implementation-detailed diagrams of the 'iptelement' hierarchy as
well as of the 'virtualdevice' hierarchy; mention composite approach, etc.}
\todo{(inspired by todo 1 above) Discuss what the interface with SymNet is. --
these parts (Instruction/:==:, etc) will be added to a separate "api" package,
to be easily accessed by other models and for better code organization.}
\todo{Before delving into the next subsections, could also mention code
structure, 3 main directories (core, extensions - one directory for each
extension -, virtdev), the driver in the root}


\subsection{Parsing}
\todo{talk about parsing, table parsing, chain parsing, ParsingContext, rule
parsing, match/target parsing, their extensions, how they are extended, etc}
\todo{for rule parsing, mention the functionality behind the 'match extension
activation', flag -m or --match}
\todo{Monadic, Parsec, functional, haskell etc}


\subsection{Validation}
\todo{WHY it is needed; say that it is analogous to semantic analysis in
compilers}
\todo{use cases: unordered chains (needed), port range validity, certain chains
in certain tables, certain rules in certain tables/chains, etc}
\todo{how it works, validate() function, validateIf variant, ValidationContext}


\subsection{Code generation}
\todo{SeflGenOptions trait, the variant for match extensions and the one for
target extensions}


\section{Extension examples}
\subsection{TCP and UDP}
\subsection{MARK and CONNMARK}
